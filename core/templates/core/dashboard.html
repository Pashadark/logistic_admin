{% extends "core/base.html" %}
{% load static %}

{% block page_title %}–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ—Ç–ø—Ä–∞–≤–∫–∞–º–∏{% endblock %}

{% block content %}
<div class="dashboard-stats">
    <div class="stat-card">
        <div class="stat-icon bg-primary text-white">
            <i class="bi bi-box-seam"></i>
        </div>
        <div class="stat-info">
            <h3>{{ total_shipments }}</h3>
            <p>–í—Å–µ–≥–æ –æ—Ç–ø—Ä–∞–≤–æ–∫</p>
        </div>
    </div>

    <div class="stat-card">
        <div class="stat-icon bg-success text-white">
            <i class="bi bi-check-circle"></i>
        </div>
        <div class="stat-info">
            <h3>{{ delivered_count }}</h3>
            <p>–î–æ—Å—Ç–∞–≤–ª–µ–Ω–æ</p>
        </div>
    </div>

    <div class="stat-card">
        <div class="stat-icon bg-warning text-dark">
            <i class="bi bi-hourglass-split"></i>
        </div>
        <div class="stat-info">
            <h3>{{ created_count }}</h3>
            <p>–ù–æ–≤—ã—Ö</p>
        </div>
    </div>

    <div class="stat-card">
        <div class="stat-icon bg-danger text-white">
            <i class="bi bi-exclamation-triangle"></i>
        </div>
        <div class="stat-info">
            <h3>{{ problem_count }}</h3>
            <p>–ü—Ä–æ–±–ª–µ–º–Ω—ã—Ö</p>
        </div>
    </div>
</div>

<div class="card">
    <div class="card-header">
        <span>–í—Å–µ –æ—Ç–ø—Ä–∞–≤–∫–∏</span>
        <a href="#" class="btn btn-sm btn-primary">
            <i class="bi bi-plus-lg me-1"></i> –ù–æ–≤–∞—è –æ—Ç–ø—Ä–∞–≤–∫–∞
        </a>
    </div>
    <div class="card-body">
        <div class="search-filter">
            <form id="shipmentFilterForm" method="get" class="w-100 d-flex flex-wrap">
                <div class="form-group flex-grow-1 me-2 mb-2">
                    <input type="text" class="form-control" id="searchInput"
                           name="search" placeholder="üîç–ü–æ–∏—Å–∫ –ø–æ –Ω–∞–∫–ª–∞–¥–Ω–æ–π, –≥–æ—Ä–æ–¥—É, id ..."
                           value="{{ search_query }}">
                </div>

                <div class="form-group me-2 mb-2" style="min-width: 180px;">
                    <select class="form-select" id="statusFilter" name="status">
                        <option value="">–í—Å–µ —Å—Ç–∞—Ç—É—Å—ã</option>
                        <option value="created" {% if status_filter == 'created' %}selected{% endif %}>üìù –°–æ–∑–¥–∞–Ω–æ</option>
                        <option value="processing" {% if status_filter == 'processing' %}selected{% endif %}>üîÑ –í –æ–±—Ä–∞–±–æ—Ç–∫–µ</option>
                        <option value="transit" {% if status_filter == 'transit' %}selected{% endif %}>üöö –í –ø—É—Ç–∏</option>
                        <option value="delivered" {% if status_filter == 'delivered' %}selected{% endif %}>‚úÖ –î–æ—Å—Ç–∞–≤–ª–µ–Ω–æ</option>
                        <option value="problem" {% if status_filter == 'problem' %}selected{% endif %}>‚ö†Ô∏è –ü—Ä–æ–±–ª–µ–º–∞</option>
                    </select>
                </div>

                <div class="form-group me-2 mb-2" style="min-width: 140px;">
                    <select class="form-select" id="typeFilter" name="type">
                        <option value="">–í—Å–µ —Ç–∏–ø—ã</option>
                        <option value="send" {% if type_filter == 'send' %}selected{% endif %}>–û—Ç–ø—Ä–∞–≤–∫–∞</option>
                        <option value="receive" {% if type_filter == 'receive' %}selected{% endif %}>–ü–æ–ª—É—á–µ–Ω–∏–µ</option>
                    </select>
                </div>

                <div class="d-flex mb-2">
                    <button type="submit" class="btn btn-primary me-2">
                        <i class="bi bi-funnel"></i> –ü—Ä–∏–º–µ–Ω–∏—Ç—å
                    </button>
                    <button type="button" id="resetFilters" class="btn btn-outline-secondary">
                        <i class="bi bi-x-circle"></i> –°–±—Ä–æ—Å–∏—Ç—å
                    </button>
                </div>
            </form>
        </div>

        <div class="table-responsive">
            <table class="table table-hover">
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>–¢–∏–ø</th>
                        <th>–ù–∞–∫–ª–∞–¥–Ω–∞—è</th>
                        <th>–ì–æ—Ä–æ–¥</th>
                        <th>–°—Ç–∞—Ç—É—Å</th>
                        <th>–î–∞—Ç–∞</th>
                        <th>–î–µ–π—Å—Ç–≤–∏—è</th>
                    </tr>
                </thead>
                <tbody>
                    {% for shipment in shipments %}
                    <tr>
                        <td>{{ shipment.id }}</td>
                        <td>
                            {% if shipment.type == 'send' %}
                                <span class="badge bg-primary">–û—Ç–ø—Ä–∞–≤–∫–∞</span>
                            {% else %}
                                <span class="badge bg-success">–ü–æ–ª—É—á–µ–Ω–∏–µ</span>
                            {% endif %}
                        </td>
                        <td>{{ shipment.waybill_number }}</td>
                        <td>{{ shipment.city }}</td>
                        <td>
                            <span class="badge badge-{{ shipment.status }}">
                                {{ shipment.get_status_display }}
                            </span>
                        </td>
                        <td>{{ shipment.timestamp|date:"d.m.Y H:i" }}</td>
                        <td>
                            <a href="/admin/cargo_admin/shipment/{{ shipment.id }}/change/"
                               class="btn btn-sm btn-outline-primary action-btn"
                               data-bs-toggle="tooltip" title="–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å">
                                <i class="bi bi-pencil"></i>
                            </a>
                            <a href="/admin/cargo_admin/shipment/{{ shipment.id }}/delete/"
                               class="btn btn-sm btn-outline-danger action-btn"
                               data-bs-toggle="tooltip" title="–£–¥–∞–ª–∏—Ç—å">
                                <i class="bi bi-trash"></i>
                            </a>
                            <a href="#"
                               class="btn btn-sm btn-outline-info action-btn"
                               data-bs-toggle="tooltip" title="–î–µ—Ç–∞–ª–∏">
                                <i class="bi bi-info-circle"></i>
                            </a>
                        </td>
                    </tr>
                    {% empty %}
                    <tr>
                        <td colspan="7" class="text-center py-4">
                            <div class="alert alert-info">
                                <i class="bi bi-info-circle me-2"></i> –û—Ç–ø—Ä–∞–≤–ª–µ–Ω–∏–π –Ω–µ –Ω–∞–π–¥–µ–Ω–æ
                            </div>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>

        <!-- Pagination -->
        {% if shipments.paginator.num_pages > 1 %}
        <nav>
            <ul class="pagination justify-content-center">
                {% if shipments.has_previous %}
                    <li class="page-item">
                        <a class="page-link" href="?page=1&search={{ search_query }}&status={{ status_filter }}&type={{ type_filter }}">&laquo; –ü–µ—Ä–≤–∞—è</a>
                    </li>
                    <li class="page-item">
                        <a class="page-link" href="?page={{ shipments.previous_page_number }}&search={{ search_query }}&status={{ status_filter }}&type={{ type_filter }}">–ü—Ä–µ–¥—ã–¥—É—â–∞—è</a>
                    </li>
                {% endif %}

                {% for num in shipments.paginator.page_range %}
                    {% if shipments.number == num %}
                        <li class="page-item active">
                            <span class="page-link">{{ num }}</span>
                        </li>
                    {% else %}
                        <li class="page-item">
                            <a class="page-link" href="?page={{ num }}&search={{ search_query }}&status={{ status_filter }}&type={{ type_filter }}">{{ num }}</a>
                        </li>
                    {% endif %}
                {% endfor %}

                {% if shipments.has_next %}
                    <li class="page-item">
                        <a class="page-link" href="?page={{ shipments.next_page_number }}&search={{ search_query }}&status={{ status_filter }}&type={{ type_filter }}">–°–ª–µ–¥—É—é—â–∞—è</a>
                    </li>
                    <li class="page-item">
                        <a class="page-link" href="?page={{ shipments.paginator.num_pages }}&search={{ search_query }}&status={{ status_filter }}&type={{ type_filter }}">–ü–æ—Å–ª–µ–¥–Ω—è—è &raquo;</a>
                    </li>
                {% endif %}
            </ul>
        </nav>
        {% endif %}
    </div>
</div>
{% endblock %}